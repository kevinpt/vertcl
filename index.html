<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>VerTcl &mdash; VerTcl 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://kevinpt.github.io/opbasm/_static/project.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Kreon:400,300,700' rel='stylesheet' type='text/css'>

   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="#">VerTcl 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="vertcl">
<h1>VerTcl<a class="headerlink" href="#vertcl" title="Permalink to this headline">¶</a></h1>
<p><strong>VerTcl is in active development. The core functionality is implemented but most builtin commands are not complete yet.</strong></p>
<p>VerTcl is a Tcl interpreter implemented in VHDL. It provides a way to execure Tcl scripts from within a VHDL simulation to enhance design verification. In the simplest case VerTcl lets you read and parse configuration data used to alter testbench stimulus. In more complex testbenches VerTcl allows interaction with a design using portable Tcl scripts within the simulaton environment rather than from the outside. This can streamline complex simulations because Tcl scripts are reloaded after resetting a simulation without having to reelaborate a design.</p>
<p>VerTcl is implemented in VHDL-93 with some optional elements using VHDL-2008 features. A significant subset of Tcl is supported with some additional commands to handle simulation control. It is largely compatible with standard Tcl but some departures from the official language are made to simplify the implementation.</p>
<p>VerTcl is useful <strong>for simulation only</strong>. It depends heavily on non-synthesizable code and cannot be converted into real hardware.</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>VerTcl is a self-contained VHDL library. It uses the string and character libraries from <a class="reference external" href="http://code.google.com/p/vhdl-extras">vhdl-extras</a> which are included. If you are using other parts of vhdl-extras in a design then you can compile it separately and ignore the string libraries included with VerTcl. You will need a VHDL simulator. Modelsim and GHDL are supported but others will work as well.</p>
<p>The optional build scripts depend on Python, bash, and GNU make. These are present on most Linux systems and can be installed on Windows using one of Msys, gnuwin32, or Cygwin.</p>
</div>
<div class="section" id="download">
<h2>Download<a class="headerlink" href="#download" title="Permalink to this headline">¶</a></h2>
<p>You can access the VerTcl Mercurial repository from <a class="reference external" href="https://code.google.com/p/vertcl/source/checkout">Google Code</a>.</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>VerTcl comes with build scripts for use with the Modelsim and GHDL simulators. You will have to manually compile for other simulators.</p>
<div class="section" id="modelsim">
<h3>Modelsim<a class="headerlink" href="#modelsim" title="Permalink to this headline">¶</a></h3>
<p>You need to initialize the project by sourcing the <tt class="docutils literal"><span class="pre">start_proj.sh</span></tt> script from a Bourne compatible shell.</p>
<div class="highlight-python"><div class="highlight"><pre>&gt; . start_proj.sh
</pre></div>
</div>
<p>This will set the <tt class="docutils literal"><span class="pre">MGC_WD</span></tt> environment variable to the current directory and construct a fresh <tt class="docutils literal"><span class="pre">modelsim.ini</span></tt> if it doesn&#8217;t exist. The <tt class="docutils literal"><span class="pre">modelsim.ini</span></tt> is modified to use external library mapping info from the <tt class="docutils literal"><span class="pre">modelsim.map</span></tt> file. If you are using a separately compiled vhdl-extras library you need to modify the mapping for &#8220;extras&#8221; to point to the correct directory.</p>
<p>After setup you can build the Modelsim libraries using the <tt class="docutils literal"><span class="pre">make</span></tt> command. The compiled output is in the <tt class="docutils literal"><span class="pre">vertcl</span></tt> library located in <tt class="docutils literal"><span class="pre">build/lib/vertcl</span></tt>. You can refer to this library from other Modelsim projects by mapping the <tt class="docutils literal"><span class="pre">vertcl</span></tt> library to this directory.</p>
</div>
<div class="section" id="ghdl">
<h3>GHDL<a class="headerlink" href="#ghdl" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="manually-compiling-vertcl">
<h3>Manually compiling VerTcl<a class="headerlink" href="#manually-compiling-vertcl" title="Permalink to this headline">¶</a></h3>
<p>If you wish to use another simulator or you&#8217;re incorporating the VerTcl source into another project you will have to compile it manually. The required files are contained within the <tt class="docutils literal"><span class="pre">rtl/extras</span></tt> and <tt class="docutils literal"><span class="pre">rtl/vertcl</span></tt> directories. You must compile these into logical libraries named &#8220;extras&#8221; and &#8220;vertcl&#8221; respectively. The sources must be compiled in the following order:</p>
<ul class="simple">
<li>extras:<ul>
<li>characters_latin_1.vhdl</li>
<li>strings_maps.vhdl</li>
<li>strings_maps_constants.vhdl</li>
<li>characters_handling.vhdl</li>
<li>strings.vhdl</li>
<li>strings_fixed.vhdl</li>
<li>strings_unbounded.vhdl</li>
</ul>
</li>
<li>vertcl:<ul>
<li>vt_expr_lexer.vhdl</li>
<li>vt_expr_parser.vhdl</li>
<li>vt_expr_interpreter.vhdl</li>
<li>vt_lexer.vhdl</li>
<li>vt_parser.vhdl</li>
<li>vt_interpreter_core.vhdl</li>
<li>vt_commands.vhdl</li>
<li>vt_interpreter.vhdl</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="using-vertcl">
<h2>Using VerTcl<a class="headerlink" href="#using-vertcl" title="Permalink to this headline">¶</a></h2>
<p>The VerTcl interpreter is represented as a variable of type <tt class="docutils literal"><span class="pre">vt_interp_acc</span></tt> conventionally named &#8220;VIO&#8221;: VerTcl Interpreter Object. The VIO variable tracks all internal state of the interpreter including Tcl variables and the execution stack of Tcl scripts. At any time the interpreter can be halted with the <tt class="docutils literal"><span class="pre">yield</span></tt> command to return control back to the calling process. When the interpreter has finished executing a script or is halted you can retrieve and set Tcl variables through the VerTcl API. Execution will resume at the next Tcl command the next time the interpreter is run. This system turns the VerTcl interpreter into a sort of coroutine that permits interaction with other processes without needing any signal drivers in the VerTcl procedures.</p>
<p>If you will only be using the interpreter from a single process then it can be declared as a local variable in that process. If multiple processes need to access the interpreter then it needs to be made a shared variable. It is best to use the VHDL-93 style shared variable for this as there are no restrictions on the use of access types. If VHDL-2002 or newer is being used, &#8216;93 style shared variables are not permitted but there is an optional protected type that exposes a subset of the VerTcl API so it can be used with the newer language standards.</p>
<p>Unfortunately, methods of protected types are not permitted to return access type values which puts some limitations on how VerTcl can be used. With a protected type for a shared VIO variable, non-numeric Tcl variables representing strings and lists cannot be directly returned using their internal representation with dynamically allocated access types. They must instead be converted to fixed length strings and potentially reparsed into their dynamic form inside the calling process. If your simulator supports designs using mixed language standards then it is possible to instantiate VHDL-93 style shared variables in a testbench while using newer standards in the rest of the design.</p>
<div class="section" id="setting-things-up">
<h3>Setting things up<a class="headerlink" href="#setting-things-up" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="executing-tcl-scripts">
<h3>Executing Tcl scripts<a class="headerlink" href="#executing-tcl-scripts" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="interacting-with-processes">
<h3>Interacting with processes<a class="headerlink" href="#interacting-with-processes" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="cleaning-up">
<h3>Cleaning up<a class="headerlink" href="#cleaning-up" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="using-the-protected-type">
<h3>Using the protected type<a class="headerlink" href="#using-the-protected-type" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="debug-mode">
<h3>Debug mode<a class="headerlink" href="#debug-mode" title="Permalink to this headline">¶</a></h3>
<p>VerTcl includes an optional memory allocation tracker to help detect memory leaks. It is implemented as a VHDL-2008 generic package in the <tt class="docutils literal"><span class="pre">vertcl_2008/alloc_tracker.vhdl</span></tt> file. It has been implemented to track allocation of parse node objects for the main and expression parsers. The relevant source lines have been commented out in the affected files to make them compatible with VHDL-93. If you wish to enable the tracker you need to run the <tt class="docutils literal"><span class="pre">uncomment_2008.sh</span></tt> script. This will find lines ending with &#8220;%2008 DEBUG%&#8221; and uncomment them. After modifying the source you must edit the <tt class="docutils literal"><span class="pre">proj.mk</span></tt> file to use VHDL-2008 as the default standard with the &#8220;DEFAULT_STD&#8221; variable. Then you can recompile the library using a VHDL-2008 compliant simulator.</p>
</div>
</div>
<div class="section" id="supported-tcl-commands">
<h2>Supported Tcl commands<a class="headerlink" href="#supported-tcl-commands" title="Permalink to this headline">¶</a></h2>
<div class="section" id="vertcl-enhancements">
<h3>VerTcl enhancements<a class="headerlink" href="#vertcl-enhancements" title="Permalink to this headline">¶</a></h3>
<p>VerTcl provides additional builtin commands to promote interaction with other processes in a simulation:</p>
<ul class="simple">
<li>wait</li>
<li>yield</li>
</ul>
<div class="section" id="wait">
<h4>wait<a class="headerlink" href="#wait" title="Permalink to this headline">¶</a></h4>
<p><strong>wait</strong> <em>delay_value</em> <em>units</em></p>
<p>The <tt class="docutils literal"><span class="pre">wait</span></tt> command provides a variable time delay using VHDL time units. It is equivalent to a &#8220;wait for&#8221; VHDL statement. The <tt class="docutils literal"><span class="pre">delay_value</span></tt> can be any numeric value and the <tt class="docutils literal"><span class="pre">units</span></tt> must be one defined for the VHDL <tt class="docutils literal"><span class="pre">time</span></tt> type. The simulation time is advanced by the requested delay after this command is executed.</p>
<div class="highlight-python"><div class="highlight"><pre>wait 10 ns ;# Delay for 10ns
</pre></div>
</div>
</div>
<div class="section" id="yield">
<h4>yield<a class="headerlink" href="#yield" title="Permalink to this headline">¶</a></h4>
<p><strong>yield</strong> <em>?value?</em></p>
<p>The <tt class="docutils literal"><span class="pre">yield</span></tt> command is analogous to the Tcl 8.6 <tt class="docutils literal"><span class="pre">yield</span></tt> command except that it results in suspending the entire VerTcl interpreter rather than a coroutine. This makes the interpreter work like a coroutine within the VHDL simulation environment. Tcl execution can be halted at any time, returning control back to the VHDL process that last invoked the interpreter. This provides an opportunity for the calling process to carry out actions that the VerTcl process can&#8217;t do on its own, such as assigning to signals. When the VerTcl interpreter is invoked again, the Tcl script will resume execution after the <tt class="docutils literal"><span class="pre">yield</span></tt> command.</p>
<p>The optional value argument is assigned to the <tt class="docutils literal"><span class="pre">VIO.return_value</span> <span class="pre">field</span></tt>. This value can be changed by the VHDL process. When the interpreter resumes the current, potentially changed, <tt class="docutils literal"><span class="pre">return_value</span></tt> is returned in the Tcl script.</p>
<div class="highlight-python"><div class="highlight"><pre>set ack [yield $result] ;# Suspend with the value of result and resume with a new value assigned to ack
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="differences-from-standard-tcl">
<h2>Differences from standard Tcl<a class="headerlink" href="#differences-from-standard-tcl" title="Permalink to this headline">¶</a></h2>
<p>VerTcl has some differences from standard Tcl.</p>
<p>The following Tcl features are not supported:</p>
<ul class="simple">
<li>Unicode</li>
<li>Namespaces</li>
<li>Hash objects</li>
<li>System I/O (files, channels, etc.)</li>
<li>Sub-interpreters</li>
<li>Coroutines (yield is supported for other use)</li>
<li>Custom math functions in expr</li>
<li>Tcl stdlib packages</li>
</ul>
<p>At a low level VerTcl works by parsing scripts into an internal tree data structure. This helps minimize the churn of repeatedly building up and reparsing strings or maintaining dual-ported objects. In some cases this results in behavior that doesn&#8217;t match the string oriented processing of Tcl. Most notably, whitespace isn&#8217;t preserved within curly-braced quotes &#8220;{...}&#8221;. This simplfies handling the most common case where this is used for quoting lists for which internal whitespace isn&#8217;t significant. If whitespace must be preserved you will need to use double-quoted strings.</p>
<p>VerTcl handles double-quoted strings less flexibly than Tcl. It will not accept them in place of curly-braced groups for control structures. In practice this is not an issue as it is rare to use quoted strings in this way with Tcl.</p>
<div class="highlight-python"><div class="highlight"><pre># This is not allowed:
if &quot;$x &lt; 10&quot; &quot;puts foo&quot;

# Curly-braces are mandatory for the script block:
if &quot;$x &lt; 10&quot; {puts foo}
</pre></div>
</div>
<p>The front end parser will convert numeric values into tokens that represent integer or float values internally. They are not treated as strings after parsing. Hexadecimal literals are converted to integers and will print out in their decimal representation. Octal literals are not supported.</p>
<div class="highlight-python"><div class="highlight"><pre>set a 0xA5
puts $a

# Prints &quot;165&quot; in VerTcl, &quot;0xA5&quot; in Tcl
</pre></div>
</div>
<p>Integer values are restricted to the range of the VHDL <tt class="docutils literal"><span class="pre">integer</span></tt> type. Unsigned integers are not supported and the smallest signed value is <tt class="docutils literal"><span class="pre">-(2**31-1)</span></tt> rather than <tt class="docutils literal"><span class="pre">-2**31</span></tt> on simulators with 32-bit integers. Modular arithmetic (silent overflow and underflow) is not supported. Bitwise operations are handled by converting between the <tt class="docutils literal"><span class="pre">unsigned</span></tt> type from <tt class="docutils literal"><span class="pre">numeric_std</span></tt> and <tt class="docutils literal"><span class="pre">integer</span></tt>.</p>
<p>The word expansion operator &#8220;{<cite>*</cite>}&#8221; introduced in Tcl 8.5 is supported with one minor difference. Standard Tcl only recognises the &#8220;{<cite>*</cite>}&#8221; character sequence as a word expansion if there is no whitespace following it. VerTcl accepts whitespace after this sequence. Consequently the standalone &#8220;{<cite>*</cite>}&#8221; string will never be parsed as a single element group containing the &#8220;<cite>*</cite>&#8221; string. If this is needed you must add space around the asterisk &#8220;{ <cite>*</cite> }&#8221;.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="#">
              <img class="logo" src="_static/vertcl.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="#">VerTcl</a></h1>



<p class="blurb">VHDL Tcl interpreter</p>



<p>
<iframe src="https://ghbtns.com/github-btn.html?user=kevinpt&repo=vertcl&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>



  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">VerTcl</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#download">Download</a></li>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#modelsim">Modelsim</a></li>
<li><a class="reference internal" href="#ghdl">GHDL</a></li>
<li><a class="reference internal" href="#manually-compiling-vertcl">Manually compiling VerTcl</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-vertcl">Using VerTcl</a><ul>
<li><a class="reference internal" href="#setting-things-up">Setting things up</a></li>
<li><a class="reference internal" href="#executing-tcl-scripts">Executing Tcl scripts</a></li>
<li><a class="reference internal" href="#interacting-with-processes">Interacting with processes</a></li>
<li><a class="reference internal" href="#cleaning-up">Cleaning up</a></li>
<li><a class="reference internal" href="#using-the-protected-type">Using the protected type</a></li>
<li><a class="reference internal" href="#debug-mode">Debug mode</a></li>
</ul>
</li>
<li><a class="reference internal" href="#supported-tcl-commands">Supported Tcl commands</a><ul>
<li><a class="reference internal" href="#vertcl-enhancements">VerTcl enhancements</a><ul>
<li><a class="reference internal" href="#wait">wait</a></li>
<li><a class="reference internal" href="#yield">yield</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#differences-from-standard-tcl">Differences from standard Tcl</a></li>
</ul>
</li>
</ul>
<h3>Other projects</h3>

<div id="proj_list">
<p>
<a href="http://kevinpt.github.io/opbasm/">Opbasm</a><br>
<a href="http://kevinpt.github.io/ripyl/">Ripyl</a><br>

<a href="http://kevinpt.github.io/vhdl-extras">Vhdl-extras</a><br>
<a href="http://kevinpt.github.io/lecroy-colorizer/">Lecroy-colorizer</a>
</p>
</div>

<script>
$(function() { // Retrieve list of repositories from Github and dynamically insert them into sidebar

if(!window.sessionStorage || !JSON) { return; } // Punt on crusty browsers (looking at you IE10)

function JSONP( url, callback ) {
	var id = ( 'jsonp' + Math.random() * new Date() ).replace('.', '');
	var script = document.createElement('script');
	script.src = url.replace( 'callback=?', 'callback=' + id );
	document.body.appendChild( script );
	window[ id ] = function( data ) {
		if (callback) {
			callback( data );
		}
	};
}

function insert_projects(projects) {
    var links = [];
    var cur_proj = "VerTcl".toLowerCase();
    $.each(projects, function(key, value) {
      if(key != cur_proj) {
        var title = key.replace(/^./, function(match) {return match.toUpperCase()}); // Capitalize first char
        links.push("<a href='"+ value +"'>" + title + "</a>");
      }
    });
    
    $("#proj_list").html("<p>"+ links.join("<br>") +"</p>");
}

var now = new Date().getTime();
if(sessionStorage.KTcacheTime && now - sessionStorage.KTcacheTime < 5*60*1000 ) { // Use cached values (5 min. expiry)
  insert_projects(JSON.parse(sessionStorage.KTprojects));
} else { // Retrieve current projects
  JSONP("https://api.github.com/users/kevinpt/repos?type=owner&callback=?", function(response) {
    var projects = {};
    $.each(response.data, function(index, value) {
      projects[value.name] = value.homepage;
    });
    
    insert_projects(projects);
    
    // Store data in session cache
    sessionStorage.KTprojects = JSON.stringify(projects);
    var now = new Date().getTime();
    sessionStorage.KTcacheTime = now;
  });  
}

});
</script>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
      &copy;2015, Kevin Thibedeau.
      
      |
      <a href="_sources/index.txt"
          rel="nofollow">Page source</a></li>
    </div>

    

    

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59631402-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>